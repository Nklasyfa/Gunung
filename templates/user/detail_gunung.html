{% extends "base.html" %}

{% block title %}{{ gunung.nama_gunung | default('Gunung Tidak Diketahui') }}{% endblock %}
{% block content_area_class %}content-area-bg{% endblock %}

{% block content %}

<div class="detail-header">
    <h1>{{ gunung.nama_gunung | default('Gunung Tidak Diketahui') }}</h1>
    <p><i class="fas fa-map-marker-alt"></i> {{ gunung.lokasi | default('Lokasi tidak tersedia') }}</p>
</div>

<div class="detail-grid">

    <div class="detail-info-card">

        {% if gunung.gambar %}
            <img src="{{ url_for('static', filename=gunung.gambar) }}" alt="{{ gunung.nama_gunung }}" style="width:100%; max-height:400px; object-fit:cover; margin-bottom:15px;">
        {% else %}
            <img src="{{ url_for('static', filename='default.jpg') }}" alt="No Image" style="width:100%; max-height:400px; object-fit:cover; margin-bottom:15px;">
        {% endif %}

        <div class="detail-stats">
            <div class="stat-item">
                <h4>Status</h4>
                {% if gunung.status_pendakian == 'Dibuka' %}
                    <p class="dibuka">{{ gunung.status_pendakian | upper }}</p>
                {% elif gunung.status_pendakian == 'Ditutup' %}
                    <p class="ditutup">{{ gunung.status_pendakian | upper }}</p>
                {% else %}
                    <p class="lainnya">{{ gunung.status_pendakian | upper | default('Tidak diketahui') }}</p>
                {% endif %}
            </div>
            <div class="stat-item">
                <h4>Ketinggian</h4>
                {% if gunung.ketinggian %}
                    <p>{{ "{:,.0f}".format(gunung.ketinggian) }} MDPL</p>
                {% else %}
                    <p>Ketinggian tidak tersedia</p>
                {% endif %}
            </div>
            <div class="stat-item">
                <h4>Estimasi</h4>
                <p>{{ gunung.estimasi_waktu | default('Tidak tersedia') }}</p>
            </div>
        </div>

        <h3>Deskripsi Gunung</h3>
        <p style="white-space: pre-wrap;">{{ gunung.deskripsi | default('Belum ada deskripsi.', true) }}</p>

        <h3 style="margin-top: 25px;">Sejarah Singkat</h3>
        <p style="white-space: pre-wrap;">{{ gunung.sejarah | default('Belum ada info sejarah.', true) }}</p>

    </div>

    <div class="booking-card">
        <div class="detail-info-card">
            <h3>Jalur Pendakian</h3>
            {% if jalur_list %}
                {% for jalur in jalur_list %}
                    <div class="jalur-item" style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                        <h4>{{ jalur.nama_jalur }}</h4>
                        <p style="white-space: pre-wrap;">{{ jalur.deskripsi | default('Belum ada deskripsi jalur.', true) }}</p>
                        <h5>Tiket Tersedia:</h5>
                        {% set tiket_for_jalur = tiket_list | selectattr('nama_jalur', 'equalto', jalur.nama_jalur) | list %}
                        {% if tiket_for_jalur %}
                            {% for tiket in tiket_for_jalur %}
                                <div class="tiket-info" style="background: #f9f9f9; padding: 10px; margin: 5px 0; border-radius: 3px;">
                                    <p><strong>Harga:</strong> Rp {{ "{:,.0f}".format(tiket.harga) }}</p>
                                    <p><strong>Kuota Harian:</strong> {{ tiket.kuota_harian }}</p>
                                    <p><strong>Berlaku hingga:</strong> {{ tiket.tanggal_berlaku.strftime('%d-%m-%Y') if tiket.tanggal_berlaku else 'Tidak ditentukan' }}</p>
                                    <a href="{{ url_for('pemesanan_tiket', jalur_id=jalur.jalur_id) }}" class="btn primary" {% if gunung.status_pendakian != 'Dibuka' %}style="pointer-events: none; opacity: 0.5;"{% endif %}>
                                        {% if gunung.status_pendakian == 'Dibuka' %}
                                            Pesan Tiket
                                        {% else %}
                                            Tidak Tersedia
                                        {% endif %}
                                    </a>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p>Tidak ada tiket tersedia untuk jalur ini.</p>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <p>Belum ada jalur pendakian yang tersedia.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
